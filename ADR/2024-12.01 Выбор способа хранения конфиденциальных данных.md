**Дата:** 2 декабря 2024 г.

**Статус:** Принято

**Контекст:**

Система геолокации обрабатывает конфиденциальные данные пользователей, такие как токены доступа, API ключи, история местоположений и другая персональная информация. Защита этих данных — критически важный аспект проекта (SEC01, SEC07, LRC01). Необходимо выбрать решение, которое обеспечит максимальную безопасность и соответствие нормативным требованиям.

**Рассмотренные варианты:**

* **HashiCorp Vault:** Инструмент для управления секретами, предоставляющий централизованное хранилище с шифрованием данных, контролем доступа и аудитом.
* **Облачные сервисы Key Management:**
    * **AWS KMS:**  Если используется инфраструктура AWS.
    * **Google Cloud KMS:** Если используется инфраструктура Google Cloud.
    * **Azure Key Vault:** Если используется инфраструктура Azure.
* **Transit Secrets Engine (встроенный в Vault):** Позволяет шифровать данные с помощью собственного ключа, хранящегося в Vault. Подходит для случаев, когда нет возможности использовать облачный KMS.
* **Яндекс.Облако S3 object storage + Yandex Lockbox:**  Комбинация объектного хранилища S3 с сервисом Yandex Lockbox для хранения секретов.

**Решение:**

Выбран **HashiCorp Vault** в сочетании с **Transit Secrets Engine**, так как проект не привязан к конкретному облачному провайдеру. Если в будущем проект будет перенесен в облако, можно будет легко переключиться на соответствующий облачный KMS.

**Обоснование:**

* **Безопасность (SEC01, SEC07):** Vault обеспечивает централизованное хранение и управление секретами, шифрование данных, строгий контроль доступа и аудит. Transit Secrets Engine позволяет шифровать данные без необходимости использования внешнего KMS, что  упрощает  начальную  настройку и  повышает  контроль  над  ключами  шифрования.
* **Аудит (SEC04):** Vault позволяет вести детальный аудит доступа к секретам, что важно для соответствия нормативным требованиям.
* **Гибкость:** Vault поддерживает различные механизмы аутентификации и авторизации, позволяя интегрироваться с существующей инфраструктурой.
* **Простота:** Transit Secrets Engine проще в настройке и управлении, чем интеграция с внешним KMS.

**Недостатки решения:**

* **Управление ключами:**  Требуется  обеспечить  безопасное  хранение  ключа  шифрования  Transit Secrets Engine.

**Последствия:**

* **Развертывание и настройка Vault:** Спланировать развертывание Vault (высокая доступность, резервное копирование), настроить политики безопасности и  настроить Transit Secrets Engine.
* **Интеграция Vault с приложением:**  Разработать механизмы получения  секретов из Vault в приложении, учитывая безопасность и производительность.
* **Управление жизненным циклом ключей шифрования:** Разработать процессы для генерации, ротации и резервного копирования ключей шифрования, используемых Transit Secrets Engine.