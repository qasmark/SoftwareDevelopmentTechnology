
**Дата:** *23 ноября 2024 г*.

**Статус:** Принято

**Контекст:**

Для эффективной работы системы геолокации необходимо определить протокол обмена данными между клиентскими приложениями (мобильные устройства, веб-браузеры) и сервером. Выбор протокола должен учитывать требования к производительности (PER), безопасности (SEC), масштабируемости (SCA), доступности (AVA), удобству использования (USA), надежности (DUR), мониторингу (MON) и организационным/юридическим требованиям (LRC).

**Рассмотренные варианты:**

1. **HTTP/1.1 + JSON (REST):** Широко используемый и поддерживаемый протокол. Простота реализации и отладки.

2. **HTTP/2 + JSON (REST):** Более производительный вариант HTTP, особенно при множественных запросах.

3. **WebSockets:**  Обеспечивает двунаправленную связь в реальном времени. Подходит для отслеживания местоположения в реальном времени.

4. **gRPC:** Высокопроизводительная RPC-платформа, использующая Protocol Buffers для сериализации данных.

**Решение:**

Выбрана комбинация **HTTP/2 + JSON (REST) для большинства взаимодействий и WebSockets для функций реального времени.**

**Обоснование:**

*   **HTTP/2 + JSON (REST):**

    1. **Производительность (PER02, PER04, PER06, PER07):** HTTP/2 предлагает улучшения производительности по сравнению с HTTP/1.1, такие как мультиплексирование, сжатие заголовков и server push, что важно для быстрой загрузки данных и отображения карты. JSON - легкий формат данных, что способствует быстрой передаче и обработке. Возможность кэширования данных.
    2. **Безопасность (SEC02):**  Легко интегрируется с HTTPS для шифрования данных.
    3. **Масштабируемость (SCA01, SCA02, SCA03):** REST API хорошо масштабируется горизонтально.
    4. **Доступность (AVA01):** Широкая поддержка и наличие инструментов упрощает обслуживание и мониторинг.
    5. **Удобство использования (USA01, USA02, USA03):**  REST API и JSON просты в использовании и интеграции с различными платформами. Широкая доступность документации и инструментов.
    6. **Надежность (DUR03):** HTTP/2 не обеспечивает  надежности как таковой, но в сочетании с правильной архитектурой приложения и механизмами повторных попыток можно добиться достаточной надежности.
    7. **Мониторинг (MON01, MON02):**  HTTP/2 и REST API легко мониторить с помощью стандартных инструментов.
    8. **Ограничения (LIM01, LIM02, LIM03):**  REST API  относительно прост в реализации, что снижает затраты на разработку.

*   **WebSockets:**

    1. **Производительность (PER01, PER02):** WebSockets идеально подходит для обновления данных о местоположении в реальном времени с минимальной задержкой.
    2. **Безопасность (SEC02):**  Поддерживает шифрование с помощью TLS (WSS).
    3. **Масштабируемость:**  Требует  внимания к архитектуре для обеспечения масштабируемости.
    4. **Удобство использования:** Несколько сложнее в реализации, чем REST.

*   **Отклонение gRPC:**

    1. **Удобство использования (USA01, USA02, USA03):**  gRPC сложнее в использовании и отладке по сравнению с REST, что повышает порог входа для разработчиков.
    2. **Ограничения (LIM01, LIM02, LIM03):** Требует дополнительных ресурсов на изучение и интеграцию.

**Недостатки решения:**

*   **WebSockets:** Увеличенная сложность реализации для функций реального времени. Потенциальные проблемы с масштабируемостью при большом количестве подключений.

**Последствия:**

*   Необходимость реализации серверной поддержки HTTP/2 и WebSockets.
*   Разработка клиентских библиотек для взаимодействия с API.
*   Настройка инфраструктуры для поддержки HTTP/2 и WebSockets.
*   Мониторинг производительности и стабильности API.