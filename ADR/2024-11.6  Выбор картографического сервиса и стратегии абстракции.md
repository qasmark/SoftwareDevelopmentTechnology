[[2024-11.4 - Выбор системы хранения данных]]
[[2024-11.12 Выбор стратегии кэширования]]
[[2024-11.11 Выбор подхода к масштабированию системы]]

**Дата:** 24 ноября 2024 г.

**Статус:** Принято

**Контекст:**

Система геолокации требует интеграции с картографическим сервисом для отображения местоположения устройств, маршрутов, геозон и других геопространственных данных. Выбор сервиса должен учитывать производительность (PER), стоимость, функциональность, доступность (AVA), удобство использования (USA),  организационные/юридические требования (LRC), а также возможность абстракции для легкой смены сервиса в будущем.

**Рассмотренные варианты:**

1. **Google Maps Platform:**  Популярный и функциональный сервис с широким набором API.
2. **OpenStreetMap:**  Бесплатный и открытый картографический сервис с активным сообществом.
3. **Mapbox:**  Платформа с гибкими настройками и возможностью использования собственных данных.
4. **Yandex.Maps:** Популярный сервис в России с хорошим покрытием и функциональностью.
5. **2GIS:**  Детальные карты городов с информацией о компаниях и организациях.

**Решение:**

Выбрана стратегия абстракции с **OpenStreetMap в качестве основного провайдера** и **адаптерами для Google Maps Platform, Mapbox, Yandex Maps, и 2GIS.**

**Обоснование:**

*   **Стратегия абстракции:**
    1. **Гибкость (PRN04):**  Абстракция позволяет легко переключаться между различными картографическими сервисами без изменения основной логики приложения. Это важно в случае изменения ценовой политики, доступности или функциональности провайдера.
    2. **Поддержка различных провайдеров:** Абстракция позволяет использовать различные картографические сервисы для разных регионов или в зависимости от потребностей пользователей (например, 2ГИС для детальной информации о городах).

*   **OpenStreetMap (основной провайдер):**

    1. **Стоимость (LIM01):** OpenStreetMap является бесплатным и открытым, что снижает затраты на разработку и поддержку.
    2. **Удобство использования (USA01, USA02, USA03):**  OpenStreetMap имеет хорошее покрытие и предоставляет данные в удобных форматах (например, GeoJSON). Активное сообщество и обширная документация.
    3. **Надежность и восстановление после сбоев (DUR02):**  Распределенная природа OpenStreetMap повышает его отказоустойчивость.

*   **Адаптеры для других сервисов:**
    1. **Производительность (PER06):** Адаптеры позволяют использовать преимущества отдельных сервисов, например, производительность и оптимизацию Google Maps Platform или детальные карты 2GIS.
    2. **Функциональность:** Адаптеры позволяют использовать специфические функции разных сервисов (например, построение маршрутов, поиск мест).

**Недостатки решения:**

*   **Увеличенная сложность:** Разработка абстрактного слоя и адаптеров увеличивает сложность системы.
*   **Производительность:** Абстрактный слой может незначительно снизить производительность.

**Последствия:**

*   Разработка абстрактного интерфейса для взаимодействия с картографическими сервисами.
*   Реализация адаптеров для Google Maps Platform, Mapbox, Yandex Maps и 2GIS.
*   Настройка механизма выбора картографического сервиса (например, на основе настроек пользователя или региона).
*   Тестирование интеграции с различными сервисами.
*   Документирование использования абстрактного слоя и адаптеров.