[[2024-11.5 Выбор протокола обмена данными между клиентом и сервером]]

**Дата:** *20 ноября 2024 г*.

**Статус:** Принято

**Контекст**

Система геолокации требует надежного и производительного хранилища данных для обработки большого объема геолокационной информации, истории перемещений, геозон и других данных. Система должна обеспечивать быстрый доступ к данным, масштабируемость, надежность и возможность пространственных запросов.

**Рассмотренные варианты:**

1. **PostgreSQL + PostGIS:** Реляционная база данных с расширением для пространственных данных.

2. **CockroachDB:** Распределенная SQL база данных с поддержкой геопространственных данных.

3. **TimescaleDB:** База данных временных рядов, построенная на PostgreSQL, подходит для хранения истории перемещений.

4. **MongoDB:** NoSQL документоориентированная база данных с поддержкой геопространственных индексов.

5. **Elasticsearch:** Полнотекстовый поисковый движок, может быть использован для хранения и поиска геопространственных данных.

6. **Redis:** Хранилище данных типа ключ-значение, используемое для кэширования.

**Решение:**

Выбрана **комбинация CockroachDB + TimescaleDB + Redis.**

**Обоснование:**

* *CockroachDB:*

    1. Распределенная архитектура: CockroachDB обеспечивает высокую доступность и отказоустойчивость благодаря своей распределенной архитектуре. Это критически важно для системы геолокации, которая должна быть доступна 24/7. (AVA01)

    2. Поддержка геопространственных данных: CockroachDB поддерживает геопространственные типы данных и запросы, что позволяет эффективно работать с геолокационной информацией. (PER01, PER03)

    3. Масштабируемость (SCA01, SCA02, SCA03): CockroachDB легко масштабируется горизонтально путем добавления новых узлов.

    4. Интеграция с Go: Существуют драйверы для работы с CockroachDB из Go.

    5. Сравнение с PostgreSQL + PostGIS: PostgreSQL + PostGIS - хорошее решение, но CockroachDB предлагает преимущества в виде распределенной архитектуры и более простого масштабирования.

* *TimescaleDB:*

    1. Хранение истории перемещений: TimescaleDB, как база данных временных рядов, идеально подходит для хранения и анализа истории перемещений устройств. (PER03)

* *Redis:*

    1. Кэширование (PER07): Redis используется для кэширования  часто запрашиваемых данных, таких как текущее местоположение устройств. (PER02, PER06)

    2. Интеграция с Go: Существуют хорошие клиенты Redis для Go.

**Недостатки решения:**

* Сложность настройки: Настройка CockroachDB и TimescaleDB может быть более сложной, чем настройка PostgreSQL.

* Управление инфраструктурой: Распределенная архитектура CockroachDB требует большего внимания к управлению инфраструктурой.

**Последствия:**

* Необходимость настройки и администрирования CockroachDB и TimescaleDB.

* Разработка схемы базы данных.

* Настройка Redis для кэширования.

* Мониторинг производительности баз данных.

* Регулярное резервное копирование данных.